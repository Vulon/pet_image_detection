schema: '2.0'
stages:
  download_annotations:
    cmd: python src/stages/download_annotations.py
    deps:
    - path: src/stages/download_annotations.py
      md5: a9e261725127989be3748cca1f731e47
      size: 1390
    params:
      params.yaml:
        dataset.coco_archive_train_filename: annotations/instances_train2017.json
        dataset.coco_archive_val_filename: annotations/instances_val2017.json
        dataset.coco_train_annotations_url: http://images.cocodataset.org/annotations/annotations_trainval2017.zip
        dataset.raw_files_folder: data/raw_input
    outs:
    - path: data/raw_input/train_anno.json
      md5: fda2d4619ae093da50f04bd024ae8dc9
      size: 529374091
    - path: data/raw_input/val_anno.json
      md5: db9d07b643d393bc84a45cd5c52085b6
      size: 22542001
  parse_annotations:
    cmd: python src/stages/parse_annotations.py
    deps:
    - path: data/raw_input/train_anno.json
      md5: fda2d4619ae093da50f04bd024ae8dc9
      size: 529374091
    - path: data/raw_input/val_anno.json
      md5: db9d07b643d393bc84a45cd5c52085b6
      size: 22542001
    - path: src/stages/parse_annotations.py
      md5: abb89803d8626abc97462d21cfc73a59
      size: 2570
    params:
      params.yaml:
        dataset.coco_categories_map:
          17: cat
          18: dog
        dataset.raw_files_folder: data/raw_input
    outs:
    - path: data/raw_input/parsed_annotations.json
      md5: 9419e0ad59d596c07dba6c8a8bf86031
      size: 9729285
  create_datasets:
    cmd: python src/stages/create_datasets.py
    deps:
    - path: data/raw_input/parsed_annotations.json
      md5: 9419e0ad59d596c07dba6c8a8bf86031
      size: 9729285
    - path: src/stages/create_datasets.py
      md5: 8ef0b1815ecb36c5505458e60a7356bb
      size: 7052
    params:
      params.yaml:
        dataset.dataset_files_folder: data/datasets
        dataset.test_fracture: 0.1
        dataset.train_fracture: 0.7
        dataset.val_fracture: 0.2
    outs:
    - path: data/datasets/test_images.h5py
      md5: d8d7182be82810044393e5082d5575c6
      size: 504223753
    - path: data/datasets/test_masks.h5py
      md5: 2a85a30bd58debb2ca24e5981cd7a141
      size: 5800441
    - path: data/datasets/train_images.h5py
      md5: 6a897e7ae908b436c42fe31f979a7266
      size: 3519966011
    - path: data/datasets/train_masks.h5py
      md5: 0df7d237358f9e60da48396698a98ef0
      size: 40336554
    - path: data/datasets/val_images.h5py
      md5: 7c744fd0f3a96d9777831066b560c923
      size: 1003216671
    - path: data/datasets/val_masks.h5py
      md5: 4e7808bc373eae8b04309503625b76b6
      size: 11535549
  prepare_code:
    cmd: pre-commit install
    deps:
    - path: .pre-commit-config.yaml
      md5: 28e16cbf6b7e5d54e1dd58b6b6a30e9c
      size: 845
  prepare_training:
    cmd: python src/stages/prepare_training.py
    deps:
    - path: params.yaml
      md5: ad13879a28e8094d36b793cfb56072e7
      size: 1552
    - path: src/stages/prepare_training.py
      md5: 5983532f038d801e9a41f3cfde53261d
      size: 1042
    outs:
    - path: src/train_package/params.yaml
      md5: 206bad31a3abd7f29df12fd73938ee4c
      size: 1558
  train_model:
    cmd: python src/train_package/train_model.py local
    deps:
    - path: data/datasets/test_images.h5py
      md5: d8d7182be82810044393e5082d5575c6
      size: 504223753
    - path: data/datasets/test_masks.h5py
      md5: 2a85a30bd58debb2ca24e5981cd7a141
      size: 5800441
    - path: data/datasets/train_images.h5py
      md5: 6a897e7ae908b436c42fe31f979a7266
      size: 3519966011
    - path: data/datasets/train_masks.h5py
      md5: 0df7d237358f9e60da48396698a98ef0
      size: 40336554
    - path: data/datasets/val_images.h5py
      md5: 7c744fd0f3a96d9777831066b560c923
      size: 1003216671
    - path: data/datasets/val_masks.h5py
      md5: 4e7808bc373eae8b04309503625b76b6
      size: 11535549
    - path: src/train_package/params.yaml
      md5: 206bad31a3abd7f29df12fd73938ee4c
      size: 1558
    - path: src/train_package/train_model.py
      md5: ac5b34ec58383a727156e0cd39813eba
      size: 8147
    outs:
    - path: output/model
      md5: a7b29073d895656c2da860b285d475e2.dir
      size: 25662626
      nfiles: 2
    - path: output/test_metrics.json
      md5: acd8b49dd2c6bf2fa856862a192a896c
      size: 289
  build_docker:
    cmd: docker build -f ScoringDockerfile --tag eu.gcr.io/curious-song-343314/pet_segmentation:0.1
      .
    deps:
    - path: ScoringDockerfile
      md5: 2034d57dac10defa6cb4dafd59797c95
      size: 453
    - path: output/model
      md5: 0f648d5e28749774d7e520400ca17d83.dir
      size: 25655678
      nfiles: 2
  upload_container:
    cmd: docker push eu.gcr.io/curious-song-343314/pet_segmentation:0.1
    deps:
    - path: ScoringDockerfile
      md5: 2034d57dac10defa6cb4dafd59797c95
      size: 453
    - path: output/model
      md5: 0f648d5e28749774d7e520400ca17d83.dir
      size: 25655678
      nfiles: 2
  create_folders:
    cmd: python src/stages/create_folders.py
