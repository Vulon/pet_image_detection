schema: '2.0'
stages:
  download_annotations:
    cmd: python src/stages/download_annotations.py
    deps:
    - path: src/stages/download_annotations.py
      md5: e18c04eb1086b719b544bf30d69ccf92
      size: 1284
    params:
      params.yaml:
        dataset.coco_archive_train_filename: annotations/instances_train2017.json
        dataset.coco_archive_val_filename: annotations/instances_val2017.json
        dataset.coco_train_annotations_url: http://images.cocodataset.org/annotations/annotations_trainval2017.zip
        dataset.raw_files_folder: data/raw_input
    outs:
    - path: data/raw_input/train_anno.json
      md5: fda2d4619ae093da50f04bd024ae8dc9
      size: 529374091
    - path: data/raw_input/val_anno.json
      md5: db9d07b643d393bc84a45cd5c52085b6
      size: 22542001
  parse_annotations:
    cmd: python src/stages/parse_annotations.py
    deps:
    - path: data/raw_input/train_anno.json
      md5: fda2d4619ae093da50f04bd024ae8dc9
      size: 529374091
    - path: data/raw_input/val_anno.json
      md5: db9d07b643d393bc84a45cd5c52085b6
      size: 22542001
    - path: src/stages/parse_annotations.py
      md5: abb89803d8626abc97462d21cfc73a59
      size: 2570
    params:
      params.yaml:
        dataset.coco_categories_map:
          17: cat
          18: dog
        dataset.raw_files_folder: data/raw_input
    outs:
    - path: data/raw_input/parsed_annotations.json
      md5: 9419e0ad59d596c07dba6c8a8bf86031
      size: 9729285
  create_datasets:
    cmd: python src/stages/create_datasets.py
    deps:
    - path: data/raw_input/parsed_annotations.json
      md5: 9419e0ad59d596c07dba6c8a8bf86031
      size: 9729285
    - path: src/stages/create_datasets.py
      md5: 8a82f353dfadc33cd138654d60d63891
      size: 7003
    params:
      params.yaml:
        dataset.dataset_files_folder: data/datasets
        dataset.test_fracture: 0.1
        dataset.train_fracture: 0.7
        dataset.val_fracture: 0.2
    outs:
    - path: data/datasets/test_images.h5py
      md5: d8d7182be82810044393e5082d5575c6
      size: 504223753
    - path: data/datasets/test_masks.h5py
      md5: 2a85a30bd58debb2ca24e5981cd7a141
      size: 5800441
    - path: data/datasets/train_images.h5py
      md5: 6a897e7ae908b436c42fe31f979a7266
      size: 3519966011
    - path: data/datasets/train_masks.h5py
      md5: 0df7d237358f9e60da48396698a98ef0
      size: 40336554
    - path: data/datasets/val_images.h5py
      md5: 177d41e3d224db2075f60f98532a6592
      size: 1000850033
    - path: data/datasets/val_masks.h5py
      md5: ecbbf9998126e370c6a21414cb0d1cd1
      size: 11508231
  prepare_code:
    cmd: pre-commit install
    deps:
    - path: .pre-commit-config.yaml
      md5: 28e16cbf6b7e5d54e1dd58b6b6a30e9c
      size: 845
  prepare_training:
    cmd: python src/stages/prepare_training.py
    deps:
    - path: params.yaml
      md5: 9878a682569bc7c64a7ea07f2294a332
      size: 1434
    - path: src/stages/prepare_training.py
      md5: 5983532f038d801e9a41f3cfde53261d
      size: 1042
    outs:
    - path: src/train_package/params.yaml
      md5: a5c844a5e007d9ee5880083c4593cff3
      size: 1440
  train_model:
    cmd: python src/train_package/train_model.py local
    deps:
    - path: data/datasets/test_images.h5py
      md5: d8d7182be82810044393e5082d5575c6
      size: 504223753
    - path: data/datasets/test_masks.h5py
      md5: 2a85a30bd58debb2ca24e5981cd7a141
      size: 5800441
    - path: data/datasets/train_images.h5py
      md5: 6a897e7ae908b436c42fe31f979a7266
      size: 3519966011
    - path: data/datasets/train_masks.h5py
      md5: 0df7d237358f9e60da48396698a98ef0
      size: 40336554
    - path: data/datasets/val_images.h5py
      md5: 177d41e3d224db2075f60f98532a6592
      size: 1000850033
    - path: data/datasets/val_masks.h5py
      md5: ecbbf9998126e370c6a21414cb0d1cd1
      size: 11508231
    - path: src/train_package/params.yaml
      md5: a5c844a5e007d9ee5880083c4593cff3
      size: 1440
    - path: src/train_package/train_model.py
      md5: e2e881adc01b214951f8150daac20571
      size: 7115
    outs:
    - path: output/model
      md5: 0f648d5e28749774d7e520400ca17d83.dir
      size: 25655678
      nfiles: 2
    - path: output/test_metrics.json
      md5: c4292baa897dd49255b6abe1721a2c72
      size: 280
  build_docker:
    cmd: docker build -f ScoringDockerfile --tag eu.gcr.io/curious-song-343314/pet_segmentation:0.1
      .
    deps:
    - path: ScoringDockerfile
      md5: 2034d57dac10defa6cb4dafd59797c95
      size: 453
    - path: output/model
      md5: 0f648d5e28749774d7e520400ca17d83.dir
      size: 25655678
      nfiles: 2
  upload_container:
    cmd: docker push eu.gcr.io/curious-song-343314/pet_segmentation:0.1
    deps:
    - path: ScoringDockerfile
      md5: 2034d57dac10defa6cb4dafd59797c95
      size: 453
    - path: output/model
      md5: 0f648d5e28749774d7e520400ca17d83.dir
      size: 25655678
      nfiles: 2
